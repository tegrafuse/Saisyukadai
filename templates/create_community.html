{% extends 'base.html' %}

{% block content %}
  <div style="display:flex;height:calc(100vh - 70px)">
    <div style="width:280px;flex-shrink:0;overflow-y:auto">
      <div class="card p-3" style="border:none;border-radius:0;height:100%">
        <h5 class="mb-3">コミュニティ</h5>
        <div class="list-group mb-3">
          <a class="list-group-item list-group-item-action" href="{{ url_for('main.index') }}">ホーム</a>
          {% for c in [] %}
            <!-- Communities will be loaded here -->
          {% endfor %}
        </div>
        <p class="text-muted small mb-0">コミュニティを作成中...</p>
      </div>
    </div>
    <div style="flex:1;overflow-y:auto;padding:20px">
      <div style="max-width:600px;margin:0 auto">
        <div class="card p-4">
          <h2 class="h4 mb-4">新規コミュニティを作成</h2>
          <form action="{{ url_for('main.create_community') }}" method="post" enctype="multipart/form-data">
            <div class="mb-3">
              <label class="form-label">コミュニティ名 <span class="text-danger">*</span></label>
              <input type="text" name="name" class="input" placeholder="コミュニティ名を入力" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label">説明</label>
              <textarea name="description" class="input" rows="4" placeholder="コミュニティの説明を入力（任意）"></textarea>
            </div>
            
            <div class="mb-4">
              <label class="form-label">コミュニティアイコン</label>
              <div class="mb-2">
                <input type="file" id="community-icon-input" name="icon" class="form-control" accept="image/*">
                <small class="text-muted d-block mt-1">推奨: 正方形の画像（PNG、JPG、GIF）</small>
              </div>
              <div id="community-icon-preview" style="display:none" class="mt-3">
                <img id="community-icon-img" src="" alt="icon preview" class="rounded" style="width:120px;height:120px;object-fit:cover">
                <button type="button" id="community-icon-remove" class="btn btn-sm btn-outline-danger mt-2">削除</button>
              </div>
            </div>
            
            <div class="d-flex gap-2">
              <button type="submit" class="btn">作成する</button>
              <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">キャンセル</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const iconInput = document.getElementById('community-icon-input');
      const preview = document.getElementById('community-icon-preview');
      const img = document.getElementById('community-icon-img');
      const removeBtn = document.getElementById('community-icon-remove');
      
      if(iconInput){
        iconInput.addEventListener('change', function(e){
          const file = e.target.files[0];
          if(!file){ preview.style.display='none'; return }
          const url = URL.createObjectURL(file);
          img.src = url;
          preview.style.display='block';
        });
        if(removeBtn){
          removeBtn.addEventListener('click', function(e){
            e.preventDefault();
            iconInput.value='';
            img.src='';
            preview.style.display='none';
          });
        }
      }
    });
  </script>
{% endblock %}
